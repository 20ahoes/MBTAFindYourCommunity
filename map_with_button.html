<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Map with Fade & Notify</title>
  <!-- [styles & Mapbox includes same as before] -->
</head>
<body>
  <!-- [buttons and #map container as before] -->

  <script>
    // [your existing init, fetch geojson, fade-layer, highlight-layer code…]

    function selectFeature(feature) {
      // …zoom & fade & highlight as before…

      // then tell the parent which town was selected
      window.parent.postMessage({
        type: 'town-selected',
        properties: feature.properties
      }, '*');
    }

    window.addEventListener('message', e => {
      if (e.data?.type === 'search-town') {
        // …find the match…
        if (match) selectFeature(match);
      }
      else if (e.data?.type === 'clear-town') {
        clearSelection();
        // also hide info on parent
        window.parent.postMessage({ type:'clear-town' }, '*');
      }
    });
  </script>
</body>
</html>
